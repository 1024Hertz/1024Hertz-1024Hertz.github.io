---
title: Centos初始化配置
tags:
  - 初始化
  - centos
---

# CentOS 7.x
* 关闭防火墙及selinux机制
~~~shell
systemctl stop firewalld.service       #停止firewall
systemctl disable firewalld.service    #禁止firewall开机启动
setenforce 0                           # 临时关闭 selinux机制
sed -i '/^SELINUX/ s/enforcing/disabled/' /etc/selinux/config    # 永久关闭selinux机制
~~~
---
* 网卡设置
~~~shell
cd /etc/sysconfig/network-scripts/
mv ifcfg-ens160 ifcfg-eth0
cp ifcfg-eth0 backup-ifcfg-eth0
vi ifcfg-eth0
~~~
~~~properties
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME="eth0"
UUID=38222614-a4ad-4d54-93df-02244b5c0b4c
DEVICE=eth0
ONBOOT=yes
IPADDR=192.168.216.99
GATEWAY=192.168.216.2
PREFIX=24
NETMASK=255.255.255.0
DNS1=114.114.114.114
DNS2=8.8.8.8
~~~
> 因 CentOS7 采用 grub2 引导，还需要对 grub2 进行修改
> 编辑 /etc/default/grub 配置文件，在 GRUB_CMDLINE_LINUX 这个参数后面加入 net.ifnames=0 biosdevname=0
~~~shell
vi /etc/default/grub
~~~
~~~properties
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0"
GRUB_DISABLE_RECOVERY="true"
~~~
> 用 grub2-mkconfig 命令重新生成GRUB配置并更新内核
~~~shell
grub2-mkconfig -o /boot/grub2/grub.cfg
~~~`
> 重启系统
~~~shell
reboot
~~~
> 配置 DNS, 同样可以在配置网卡的时候配置 DNS1 / DNS2
~~~shell
vi /etc/resolv.conf 
~~~
~~~
# Generated by NetworkManager
search centos7
nameserver 114.114.114.114
nameserver 8.8.8.8
~~~
---
* SSH配置
~~~shell
yum install openssh-server
~~~
> 查看`openssh-server`是否启动
~~~shell
ps -ef |grep ssh
~~~
> 开机启动
~~~shell
vi  /etc/rc.d/rc.local
# 追加
/etc/init.d/ssh start
~~~
---
* 更换yum源
> 备份
~~~shell
cd /etc/yum.repos.d && mkdir backup
mv *.repo backup
~~~
> 下载
~~~shell
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
# 或者使用 curl
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
~~~
> 清除yum缓存
~~~shell
yum clean all
~~~
> 缓存yum源的安装包
~~~shell
yum makecache
yum update
~~~
---
## yum update和yum upgrade的区别：
> 它们都对软件进行升级，也都对内核进行升级。(重启进入新内核，uname -r查看)
* 唯一的区别:
    * yum update不删除旧包
    * yum upgrade删除旧包
* 在生产环境中最好使用yum update,防止因旧软件包依赖而出现问题
---
* 安装系统软件库
~~~shell
yum -y groupinstall "Development tools"
yum -y install vim lrzsz ntp unzip wget \
  perl gcc gcc-c++ make cmake kernel kernel-headers \
  kernel-devel net-tools telnet
~~~

---
* 时间同步
> 将ntp服务设置为缺省启动
~~~shell
systemctl start ntpd.service
systemctl enable ntpd.service
vi /etc/sysconfig/ntpd
~~~
~~~properties
OPTIONS="-g -x"
~~~
> 重新启动
~~~shell
systemctl restart ntpd.service
~~~
> 系统时区改为上海时间 (亦即CST时区)
~~~shell
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
~~~
> 手动同步
~~~shell
ntpdate 0.centos.pool.ntp.org
ntpdate ntp2.aliyun.com
ntpdate ntp1.aliyun.com
~~~
> 配置ntp server
~~~shell
vim /etc/ntp.conf
server ntp1.aliyun.com
server ntp2.aliyun.com
server time1.aliyun.com
server time2.aliyun.com
~~~
---